"use strict";(self["webpackChunkcmp"]=self["webpackChunkcmp"]||[]).push([[262],{91262:function(e,l,c){c.r(l),c.d(l,{default:function(){return d}});var t=function(){var e=this,l=e._self._c;return l("div",{staticClass:"container"},[l("el-scrollbar",{staticClass:"container-content"},[l("div",{staticClass:"container-content-form"},[l("el-form",{ref:"roleForm",attrs:{rules:e.rules,model:e.roleForm}},[l("el-form-item",{attrs:{label:e.$t("roleMag.roleName"),prop:"roleName"}},[l("el-input",{attrs:{disabled:e.readOnly,placeholder:e.inputPh("roleMag.roleName"),maxlength:"20"},model:{value:e.roleForm.roleName,callback:function(l){e.$set(e.roleForm,"roleName",l)},expression:"roleForm.roleName"}})],1),l("el-form-item",{attrs:{label:e.$t("roleMag.remark"),prop:"remark"}},[l("el-input",{attrs:{disabled:e.readOnly,type:"textarea",rows:"4",placeholder:e.inputPh("roleMag.remark"),maxlength:"20"},model:{value:e.roleForm.remark,callback:function(l){e.$set(e.roleForm,"remark",l)},expression:"roleForm.remark"}})],1),l("el-form-item",{attrs:{label:e.$t("roleMag.menuPriv"),prop:"isCheckPrivilege"}},[l("div",{staticClass:"menu-power-list"},[l("div",{staticClass:"menu-power-header"},[e._v(" "+e._s(e.$t("roleMag.menuName"))+" "),l("span",{staticClass:"operation-power"},[e._v(e._s(e.$t("roleMag.privAction")))])]),l("div",[l("div",{staticClass:"menu-power-body"},[l("div",{staticClass:"check-all"},[l("el-checkbox",{attrs:{disabled:e.readOnly},on:{change:function(l){return e.checkAll()}},model:{value:e.checkedAll,callback:function(l){e.checkedAll=l},expression:"checkedAll"}},[e._v(e._s(e.$t("roleMag.checkAll")))])],1),e._l(e.menuPower,(function(c){return l("div",{key:c.menuId,staticClass:"menu-power-wrap"},[l("div",{staticClass:"one-level",on:{click:function(l){return e.showMenu(c)}}},[l("div",{staticClass:"level-menu"},[l("el-checkbox",{attrs:{disabled:c.disabled||e.readOnly},on:{change:function(l){return e.handleCheckedMenuChange(1,c)}},model:{value:c.checked,callback:function(l){e.$set(c,"checked",l)},expression:"item.checked"}},[e._v(" "+e._s(e.displayName(c))+" ")])],1),l("div",{staticClass:"one-level-expand"},[l("i",{class:c.isShow?"el-icon-arrow-down":"el-icon-arrow-up"})])]),c.children&&c.children.length>0?e._l(c.children,(function(t){return l("div",{key:t.menuId},[l("div",{directives:[{name:"show",rawName:"v-show",value:c.isShow,expression:"item.isShow"}],staticClass:"two-level"},[l("div",{staticClass:"level-menu"},[l("el-checkbox",{attrs:{disabled:t.disabled||e.readOnly},on:{change:function(l){return e.handleCheckedMenuChange(2,c,t)}},model:{value:t.checked,callback:function(l){e.$set(t,"checked",l)},expression:"cItem.checked"}},[e._v(" "+e._s(e.displayName(t))+" ")])],1),l("div",{staticClass:"level-power"},e._l(t.children,(function(r){return l("el-checkbox",{key:r.compId,attrs:{disabled:r.disabled||e.readOnly},on:{change:function(l){return e.handleCheckedPowerChange(c,t,{},r)}},model:{value:r.checked,callback:function(l){e.$set(r,"checked",l)},expression:"cItemPower.checked"}},[e._v(" "+e._s(e.displayName(r))+" ")])})),1)])])})):e._e()],2)}))],2)])])])],1)],1)]),e.readOnly?e._e():l("div",{staticClass:"container-bottom"},[l("span",{staticClass:"container-bottom-button-group"},[l("el-button",{attrs:{type:"primary"},on:{click:function(l){return e.updateSysRole()}}},[e._v(e._s(e.$t("common.save")))]),l("el-button",{on:{click:e.closeWin}},[e._v(e._s(e.$t("common.cancel")))])],1)])],1)},r=[],i=c(41090),o=c(45101),s={mixins:[i.Z],data(){return{roleForm:{roleName:"",remark:"",privileges:[],isCheckPrivilege:!1},readOnly:this.$route.query.readOnly,roleId:this.$route.query.roleId,rules:{roleName:[{max:20,required:!0,message:"请输入角色名称"}],isCheckPrivilege:[{required:!0,message:"请选择权限"}]},roleDetail:{},checkedAll:!1,menuPower:[],roleMenuNameOption:[]}},computed:{user(){return this.$store.state.user}},watch:{menuPower:{handler(){let e=this.menuPower.filter((e=>e.checked)),l=[];this.menuPower.forEach((function(c,t){const r=c.children||[],i=r.filter((e=>e.checked));i.length>0&&(e=e.concat(i)),r.forEach((function(c,t){if("1"===c.isLeaf){const e=(c.children||[]).filter((e=>e.checked));e.length>0&&(l=l.concat(e))}else{const t=c.children||[],r=t.filter((e=>e.checked));r.length>0&&(e=e.concat(r)),t.forEach((function(e,c){const t=(e.children||[]).filter((e=>e.checked));t.length>0&&(l=l.concat(t))}))}}))})),this.roleForm.isCheckPrivilege=e.length>0&&l.length>0},deep:!0}},mounted(){this.initRole()},methods:{initRole(){this.querySysRoleDetail()},async querySysRoleDetail(){if(this.loading=!0,this.roleId)this.roleDetail=await(0,o.Z)("/role/queryRoleDetail",{roleId:this.roleId},{method:"get"}),this.menuPower=this.roleDetail.privileges,this.menuPower.forEach((e=>{this.showMenu(e)})),this.roleForm={...this.roleDetail};else{const e=await(0,o.Z)("/role/queryPrivileges",{menuFlag:0},{method:"get"});e.forEach((e=>{this.showMenu(e)})),this.menuPower=e}this.loading=!1},updateSysRole(){this.loading=!0,this.$refs.roleForm.validate((e=>{if(e){this.menuPower||(this.menuPower=[]);let e=this.menuPower.filter((e=>e.checked)),l=[];if(this.menuPower.forEach((function(c,t){const r=c.children||[],i=r.filter((e=>e.checked));i.length>0&&(e=e.concat(i)),r.forEach((function(c,t){if("1"===c.isLeaf){const e=(c.children||[]).filter((e=>e.checked));e.length>0&&(l=l.concat(e))}else{const t=c.children||[],r=t.filter((e=>e.checked));r.length>0&&(e=e.concat(r)),t.forEach((function(e,c){const t=(e.children||[]).filter((e=>e.checked));t.length>0&&(l=l.concat(t))}))}}))})),0===e.length&&0===l.length)return void this.$message({type:"error",message:this.$t("roleMag.pleasePriv")});this.roleForm.privileges=this.menuPower,this.$api.sys.role.updateSysRole(this.roleForm).then((e=>{this.$message({type:"success",message:this.roleId?this.$t("roleMag.modifySuccess"):this.$t("roleMag.createSuccess")}),this.closeWin()})).finally((()=>{this.loading=!1}))}else this.$message({type:"error",message:this.$t("roleMag.fullFill")})}))},checkAll(){let e=!1;this.checkedAll&&(e=!0),(this.menuPower||[]).forEach((l=>{(l.children||[]).forEach((l=>{(l.children||[]).forEach((l=>{(l.children||[]).forEach((l=>{l.checked=e})),l.checked=e})),l.checked=e})),l.checked=e}))},closeWin(){history.go(-1)},showMenu(e){void 0===e.isShow&&this.$set(e,"isShow",!1),e.isShow=!e.isShow},handleCheckedMenuChange(e,l={},c={},t={}){let r=!1;if(1===e)l.checked&&(r=!0),(l.children||[]).forEach((e=>{(e.children||[]).forEach((e=>{(e.children||[]).forEach((e=>{e.checked=r})),e.checked=r})),e.checked=r}));else if(2===e){if(c.checked)r=!0,l.checked=!0;else{const e=(l.children||[]).filter((e=>e.checked));0===e.length&&(l.checked=!1)}(c.children||[]).forEach((e=>{(e.children||[]).forEach((e=>{e.checked=r})),e.checked=r}))}else{if(t.checked)r=!0,l.checked=!0,c.checked=!0;else{const e=(c.children||[]).filter((e=>e.checked));0===e.length&&(c.checked=!1);const t=(l.children||[]).filter((e=>e.checked));0===t.length&&(l.checked=!1)}(t.children||[]).forEach((e=>{e.checked=r}))}},handleCheckedPowerChange(e={},l={},c={},t={}){t.checked&&(e.checked=!0,l.checked=!0,c.checked=!0)},displayName(e){return"zh"===this.$i18n.locale?e.privName:e.enPrivName}}},n=s,a=c(43736),h=(0,a.Z)(n,t,r,!1,null,"1444e6d6",null),d=h.exports}}]);
//# sourceMappingURL=262.9fa1405c.js.map