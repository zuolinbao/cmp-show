"use strict";(self["webpackChunkcmp"]=self["webpackChunkcmp"]||[]).push([[126],{65986:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"container-form"},[t("el-form",{ref:"qryParamRef",attrs:{model:e.qryParam,size:"small"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:5}},[t("el-form-item",{attrs:{label:e.$t("accountMag.account"),prop:"userCode"}},[t("el-input",{attrs:{placeholder:e.inputPh("accountMag.account")},model:{value:e.qryParam.userCode,callback:function(t){e.$set(e.qryParam,"userCode",t)},expression:"qryParam.userCode"}})],1)],1),t("el-col",{attrs:{span:5}},[t("el-form-item",{attrs:{label:e.$t("accountMag.userName"),prop:"userName"}},[t("el-input",{attrs:{placeholder:e.inputPh("accountMag.userName")},model:{value:e.qryParam.userName,callback:function(t){e.$set(e.qryParam,"userName",t)},expression:"qryParam.userName"}})],1)],1),t("el-col",{attrs:{span:5}},[t("el-form-item",{attrs:{label:e.$t("common.status"),prop:"statusCd"}},[t("ct-select",{attrs:{placeholder:e.selectPh("common.status"),options:e.statusCdOption},model:{value:e.qryParam.statusCd,callback:function(t){e.$set(e.qryParam,"statusCd",t)},expression:"qryParam.statusCd"}})],1)],1),t("el-col",{attrs:{span:5}},[t("el-form-item",{attrs:{label:e.$t("accountMag.createTime"),prop:"qryTime"}},[t("ct-date-picker",{attrs:{begin:e.qryParam.createTimeBegin,end:e.qryParam.createTimeEnd},on:{"update:begin":function(t){return e.$set(e.qryParam,"createTimeBegin",t)},"update:end":function(t){return e.$set(e.qryParam,"createTimeEnd",t)}}})],1)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{"label-width":"0"}},[t("div",{staticClass:"search-button-group"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.qryCmpParamPage(!1)}}},[e._v(e._s(e.$t("common.query"))+" ")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.reset}},[e._v(e._s(e.$t("common.reset")))])],1)])],1)],1),t("div",{directives:[{name:"compPriv",rawName:"v-compPriv",value:41,expression:"41"}],staticClass:"tool-button-group"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v(e._s(e.$t("accountMag.createAccount")))]),t("el-button",{directives:[{name:"compPriv",rawName:"v-compPriv",value:46,expression:"46"}],attrs:{icon:"el-icon-view"},on:{click:e.viewPlain}},[e._v(" "+e._s(e.$t("accountMag.viewPlain")))])],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticClass:"container-table",attrs:{data:e.tableData,border:!0,"overflow-x":"scroll",height:"100%"}},[t("el-table-column",{attrs:{prop:"userCode",label:e.$t("accountMag.userCode"),"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{staticClass:"cor-blue",on:{click:function(t){return e.toDetail(a.row)}}},[e._v(e._s(a.row.userCode))])]}}])}),t("el-table-column",{attrs:{prop:"userName",label:e.$t("accountMag.userName"),"show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"email",label:e.$t("accountMag.email"),"show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"statusCd",label:e.$t("common.status"),formatter:e.rowFomatter,"show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"createTime",label:e.$t("accountMag.createTime"),"show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:e.$t("common.action"),fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticClass:"action-button-group"},[t("el-button",{directives:[{name:"compPriv",rawName:"v-compPriv",value:42,expression:"42"}],attrs:{type:"text"},on:{click:function(t){return e.modify(a.row)}}},[e._v(e._s(e.$t("common.edit")))]),"1000"===a.row.statusCd?t("el-button",{directives:[{name:"compPriv",rawName:"v-compPriv",value:45,expression:"45"}],attrs:{type:"text"},on:{click:function(t){return e.disableCmpParam(a.row.userId)}}},[e._v(e._s(e.$t("accountMag.stop")))]):t("el-button",{directives:[{name:"compPriv",rawName:"v-compPriv",value:45,expression:"45"}],attrs:{type:"text"},on:{click:function(t){return e.enableCmpParam(a.row.userId)}}},[e._v(e._s(e.$t("accountMag.activate")))]),t("el-button",{directives:[{name:"compPriv",rawName:"v-compPriv",value:43,expression:"43"}],staticClass:"cor-red",attrs:{type:"text"},on:{click:function(t){return e.clickDelete(a.row.userId)}}},[e._v(e._s(e.$t("common.delete")))])],1)]}}])})],1),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.tableData.length>0,expression:"tableData.length > 0"}],attrs:{background:"","current-page":e.page.pageIndex,align:"right","page-sizes":[10,20,50,100],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("AddEditDialog",{attrs:{visible:e.addEditDialogVisible,"modify-title":e.modifyTitle,"modify-flag":e.modifyFlag,"user-id":e.userId},on:{"update:visible":function(t){e.addEditDialogVisible=t},modifyParam:function(t){return e.qryCmpParamPage(t)}}}),t("ViewPlainDialog",{attrs:{visible:e.plainDialogVisible},on:{"update:visible":function(t){e.plainDialogVisible=t}}})],1)},r=[],o=(a(70560),a(41090)),i=a(45101),l=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:e.modifyTitle,visible:e.v,"before-close":e.handleClose,width:"520px","close-on-click-modal":!1,"append-to-body":"",top:"5vh"},on:{"update:visible":function(t){e.v=t}}},[t("el-form",{ref:"paramFormRef",staticClass:"demo-ruleForm",attrs:{model:e.paramForm,rules:e.paramRules,size:"small"}},[t("el-form-item",{attrs:{label:e.$t("accountMag.account"),prop:"userCode"}},[t("el-input",{attrs:{disabled:!!e.userId,placeholder:e.inputPh("accountMag.account")},model:{value:e.paramForm.userCode,callback:function(t){e.$set(e.paramForm,"userCode",t)},expression:"paramForm.userCode"}})],1),t("el-form-item",{attrs:{label:e.$t("accountMag.userName"),prop:"userName"}},[t("el-input",{attrs:{placeholder:e.inputPh("accountMag.userName")},model:{value:e.paramForm.userName,callback:function(t){e.$set(e.paramForm,"userName",t)},expression:"paramForm.userName"}})],1),t("el-form-item",{attrs:{label:e.$t("accountMag.roleId"),prop:"roleId"}},[t("ct-async-select",{attrs:{url:"/role/queryRoleByUserId",method:"get","label-key":"roleName","value-key":"roleId",placeholder:e.selectPh("accountMag.roleId")},model:{value:e.paramForm.roleId,callback:function(t){e.$set(e.paramForm,"roleId",t)},expression:"paramForm.roleId"}})],1),t("el-form-item",{attrs:{label:e.$t("accountMag.email"),prop:"email"}},[t("el-input",{attrs:{disabled:!!e.userId,placeholder:e.inputPh("accountMag.email")},model:{value:e.paramForm.email,callback:function(t){e.$set(e.paramForm,"email",t)},expression:"paramForm.email"}})],1),t("el-form-item",{attrs:{label:e.$t("accountMag.phone"),prop:"phone"}},[t("el-input",{attrs:{placeholder:e.inputPh("accountMag.phone")},model:{value:e.paramForm.phone,callback:function(t){e.$set(e.paramForm,"phone",t)},expression:"paramForm.phone"}})],1),t("el-form-item",{attrs:{label:e.$t("accountMag.fax"),prop:"fax"}},[t("el-input",{attrs:{placeholder:e.inputPh("accountMag.fax")},model:{value:e.paramForm.fax,callback:function(t){e.$set(e.paramForm,"fax",t)},expression:"paramForm.fax"}})],1),t("el-form-item",{attrs:{label:e.$t("common.remark"),prop:"remark"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:e.inputPh("accountMag.account"),maxlength:"20"},model:{value:e.paramForm.remark,callback:function(t){e.$set(e.paramForm,"remark",t)},expression:"paramForm.remark"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickOk}},[e._v(e._s(e.$t("common.ok")))]),t("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v(e._s(e.$t("common.cancel")))])],1)],1)],1)},n=[],c={mixins:[o.Z],props:{visible:{type:Boolean,default:!1},modifyTitle:{type:String,default:""},userId:{type:String,default:""},modifyFlag:{type:[Number,String],default:0}},data(){return{paramForm:{},defaultForm:{email:"",fax:"",phone:"",remark:"",roleId:"",userCode:"",userName:"",userId:""},areaCodeOptions:[],statusCd:"1000",paramRules:{userCode:[{required:!0,validator:this.validateUserCode,trigger:"blur"}],userName:[{required:!0,min:1,max:32,message:this.$t("accountMag.userName32"),trigger:"blur"}],email:[{required:!0,type:"email",message:this.inputPh("accountMag.email"),trigger:"blur"}],mobile:[{required:!0,validator:this.validatePhone,trigger:"blur"}],roleId:[{required:!0,message:this.selectPh("accountMag.roleId"),trigger:"blur"}]}}},computed:{v:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},watch:{visible(e){e&&(this.userId?this.queryDetail(this.userId):this.paramForm={...this.defaultForm})}},mounted(){},methods:{async queryDetail(e){const t=await(0,i.Z)("/user/querySystemUserDetail",{userId:e,modifyFlag:this.modifyFlag},{method:"get"}),a={...t};a.emailDesc&&(a.email=a.emailDesc),a.faxDesc&&(a.fax=a.faxDesc),a.mobileDesc&&(a.mobile=a.mobileDesc),a.phoneDesc&&(a.phone=a.phoneDesc),a.userNameDesc&&(a.userName=a.userNameDesc),this.paramForm={...a}},clickOk(){this.$refs.paramFormRef.validate((e=>{if(!e)return;const t=this.userId?this.$t("accountMag.modifySuccess"):this.$t("accountMag.createSuccess");(0,i.Z)("/user/saveUser",{...this.paramForm},{method:"post"}).then((e=>{this.$refs.paramFormRef.clearValidate(),this.$message.success(t),this.v=!1,this.$emit("modifyParam",!1)}))}))},cancel(){this.v=!1,this.$refs.paramFormRef.clearValidate()},handleClose(){this.cancel()},validateUserCode(e,t,a){/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d_]{6,32}$/.test(t)?a():a(new Error(this.$t("accountMag.userCode632")))},validatePhone(e,t,a){this.paramForm.areaCode||a(new Error(this.selectPh("accountMag.areaCode"))),/^\d{1,15}$/.test(t)||a(new Error(this.$t("accountMag.correctMobile"))),a()}}},m=c,u=a(43736),d=(0,u.Z)(m,l,n,!1,null,"51692df8",null),p=d.exports,h=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{attrs:{title:e.$t("api.viewPlain"),visible:e.v,"before-close":e.handleClose,width:"520px","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.v=t}}},[t("el-form",{ref:"paramFormRef",attrs:{model:e.paramForm,rules:e.paramRules,size:"small"}},[t("el-form-item",{attrs:{label:e.$t("api.currentEmail"),prop:"email"}},[t("el-input",{attrs:{disabled:""},model:{value:e.paramForm.email,callback:function(t){e.$set(e.paramForm,"email",t)},expression:"paramForm.email"}})],1),t("el-form-item",{attrs:{label:e.$t("api.checkCode"),prop:"verifyCode"}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:19}},[t("el-input",{attrs:{placeholder:e.inputPh("api.checkCode")},model:{value:e.paramForm.verifyCode,callback:function(t){e.$set(e.paramForm,"verifyCode",t)},expression:"paramForm.verifyCode"}})],1),t("el-col",{attrs:{span:3}},[e.countingDown?t("el-button",{key:"2",attrs:{disabled:""}},[e._v(e._s(e.$t("login.countDown",{countDownNum:e.countDownTime})))]):t("el-button",{key:"1",attrs:{type:"primary",size:"small"},on:{click:e.sendSms}},[e._v(e._s(e.$t("api.sendCode")))])],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clickOk}},[e._v(e._s(e.$t("common.ok")))]),t("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v(e._s(e.$t("common.cancel")))])],1)],1)],1)},g=[],f={mixins:[o.Z],props:{visible:{type:Boolean,default:!1},modifyForm:{type:Object,default:()=>null}},data(){return{countDownTime:60,countingDown:!1,paramForm:{},defaultForm:{email:this.$store.state.user.user.email,verifyCode:""},paramRules:{email:[{required:!0,message:this.inputPh("accountMag.email"),trigger:"blur"}],verifyCode:[{required:!0,message:this.inputPh("api.checkCode")}]}}},computed:{v:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},watch:{visible(e){e&&(this.modifyForm?this.paramForm={...this.modifyForm}:this.paramForm={...this.defaultForm},this.$nextTick((()=>{this.$refs.paramFormRef.clearValidate()})))}},mounted(){},methods:{clickOk(){this.$refs.paramFormRef.validate((e=>{e&&(0,i.Z)("/user/viewPlainText",{...this.paramForm,sceneCode:"view_plain_text"},{method:"get"}).then((e=>{this.$refs.paramFormRef.resetFields(),this.$message.success(this.$t("accountMag.setSuccess")),this.v=!1,this.$emit("modifyParam",!0)}))}))},async sendSms(){await(0,i.Z)("/user/sendMail",{sceneCode:"view_plain_text"},{method:"get"}),this.$message.success(this.$t("accountMag.sendSuccess")),this.startCountDown()},cancel(){this.resetCountDown(),this.$refs.paramFormRef.clearValidate(),this.v=!1},handleClose(){this.cancel()},startCountDown(){this.countingDown=!0;const e=setInterval((()=>{this.countDownTime>1?this.countDownTime--:(clearInterval(e),this.resetCountDown())}),1e3)},resetCountDown(){this.countingDown=!1,this.countDownTime=60}}},v=f,b=(0,u.Z)(v,h,g,!1,null,"951c4e1c",null),y=b.exports,$={components:{AddEditDialog:p,ViewPlainDialog:y},mixins:[o.Z],data(){return{powerSearch:!1,loading:!1,page:{pageIndex:1,pageSize:10,total:0},channelIdOptions:[],roleIdOptions:[],tableData:[],modifyTitle:"新建",modifyFlag:"",addEditDialogVisible:!1,plainDialogVisible:!1,statusCd:"1000",selectUserVisible:!1,selectCustomerVisible:!1,qryParam:{userCode:"",statusCd:"",userName:"",createTimeBegin:"",createTimeEnd:""},saleList:[],userId:"",pickerOptions:{disabledDate(e){return e.getTime()<Date.now()-2592e6||e.getTime()>Date.now()}}}},computed:{statusCdOption(){return[{value:"1000",label:this.$t("simMag.statusCdGood")},{value:"1100",label:this.$t("simMag.statusCdBad")}]}},mounted(){this.qryCmpParamPage(!1)},methods:{async queryRoleList(){this.qryParam.roleId="",this.roleIdOptions=[];const e=await(0,i.Z)("/sysrole/queryRoleList",{channelId:this.qryParam.channelId||0,custId:this.qryParam.custId},{method:"post"});this.roleIdOptions=e.map((e=>({value:e.roleId,label:e.roleName})))},qryCmpParamPage(e){e||(this.page.pageIndex=1,this.page.pageSize=10);const t={...this.qryParam,...this.page};this.loading=!0,this.$api.custMag.queryUser(t).then((e=>{e.list.forEach((e=>{e.emailDesc&&(e.email=e.emailDesc),e.faxDesc&&(e.fax=e.faxDesc),e.mobileDesc&&(e.mobile=e.mobileDesc),e.phoneDesc&&(e.phone=e.phoneDesc),e.userNameDesc&&(e.userName=e.userNameDesc)})),this.tableData=e.list,this.page.total=e.total})).finally((()=>{this.loading=!1}))},handleSizeChange(e){this.page.pageSize=e,this.page.pageIndex=1,this.qryCmpParamPage(!0)},handleCurrentChange(e){this.page.pageIndex=e,this.qryCmpParamPage(!0)},add(){this.addEditDialogVisible=!0,this.modifyTitle=this.$t("accountMag.createAccount"),this.modifyFlag=0,this.userId=null},modify(e){this.addEditDialogVisible=!0,this.modifyTitle=this.$t("accountMag.editAccount"),this.modifyFlag=1,this.userId=e.userId},toDetail({userId:e}){this.$router.push({path:"accountDetail",query:{userId:e}})},viewPlain(){this.plainDialogVisible=!0},modifyParam(e){e&&(this.userId=null,this.qryCmpParamPage(!1))},clickDelete(e){this.$confirm(this.$t("accountMag.deleteAsk"),{confirmButtonText:this.$t("common.yes"),cancelButtonText:this.$t("common.no"),type:"warning"}).then((()=>{this.loading=!0,(0,i.Z)("/user/removeSystemUser",{userId:e},{method:"get"}).then((e=>{this.$message({type:"success",message:this.$t("common.deleteSuccess")}),this.qryCmpParamPage(!1)})).finally((()=>{this.loading=!1}))})).catch((()=>{}))},async changeStatus(e,t){try{await(0,i.Z)("/user/changeStatus",{userId:e,statusCd:t},{method:"get"});const a="1000"===t?this.$t("accountMag.activateSuccess"):this.$t("accountMag.stopSuccess");this.$message({type:"success",message:a}),this.qryCmpParamPage(!0)}catch(a){console.log(a)}},enableCmpParam(e){const t=this;this.$confirm(this.$t("accountMag.activateAsk"),this.$t("accountMag.activateAccount"),{confirmButtonText:this.$t("common.yes"),cancelButtonText:this.$t("common.no"),type:"success"}).then((async()=>{await t.changeStatus(e,"1000")})).catch((()=>{}))},disableCmpParam(e){this.$confirm(this.$t("accountMag.stopAsk"),this.$t("accountMag.stopAccount"),{confirmButtonText:this.$t("common.yes"),cancelButtonText:this.$t("common.no"),type:"warning"}).then((()=>{this.changeStatus(e,"1100")})).catch((()=>{}))},reset(){this.$refs.qryParamRef.resetFields(),this.qryCmpParamPage(!1)},rowFomatter(e,t,a){if("statusCd"===t.property)return"1000"===a?this.$t("simMag.statusCdGood"):this.$t("simMag.statusCdBad")}}},C=$,P=(0,u.Z)(C,s,r,!1,null,"6ecd23f3",null),w=P.exports}}]);
//# sourceMappingURL=126.5da9e876.js.map