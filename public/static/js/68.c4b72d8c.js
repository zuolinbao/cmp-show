"use strict";(self["webpackChunkcmp"]=self["webpackChunkcmp"]||[]).push([[68],{41986:function(e,a,t){t.r(a),t.d(a,{default:function(){return m}});var l=function(){var e=this,a=e._self._c;return a("div",{staticClass:"container"},[a("div",{staticClass:"container-form"},[a("el-form",{ref:"qryParamRef",attrs:{model:e.qryParam,rules:e.paramRules,size:"small"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:e.$t("simMag.addressId"),prop:"addressIds"}},[a("ct-async-select",{attrs:{placeholder:e.selectPh("simMag.addressId"),url:"/prodInst/getSupplierListForQuery",method:"get","label-key":"attrValueName","value-key":"attrValue"},model:{value:e.qryParam.addressIds,callback:function(a){e.$set(e.qryParam,"addressIds",a)},expression:"qryParam.addressIds"}})],1)],1),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:e.$t("traffic.groupId"),prop:"accessNumber"}},[a("el-input",{attrs:{type:"number",placeholder:e.inputPh("traffic.groupId")},model:{value:e.qryParam.accessNumber,callback:function(a){e.$set(e.qryParam,"accessNumber",a)},expression:"qryParam.accessNumber"}})],1)],1),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{label:e.$t("traffic.billCycle"),prop:"billCycle"}},[a("BillCycleSelect",{model:{value:e.qryParam.billCycle,callback:function(a){e.$set(e.qryParam,"billCycle",a)},expression:"qryParam.billCycle"}})],1)],1),a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{"label-width":"0"}},[a("div",{staticClass:"search-button-group"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(a){return e.loadData(!1)}}},[e._v(e._s(e.$t("common.query")))]),a("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.reset}},[e._v(e._s(e.$t("common.reset")))])],1)])],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticClass:"container-table",attrs:{data:e.tableData,border:!0,height:"100%",width:"100%"}},[a("el-table-column",{attrs:{prop:"accNum",label:e.$t("traffic.groupId"),"show-overflow-tooltip":"",resizable:"","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"cor-blue",on:{click:function(a){return e.toDetail(t.row)}}},[e._v(e._s(t.row.accNum))])]}}])}),a("el-table-column",{attrs:{prop:"useCustName",label:e.$t("traffic.useCustName"),"show-overflow-tooltip":"","min-width":"110"}}),a("el-table-column",{attrs:{label:e.$t("traffic.memberMag"),"min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"cor-blue el-icon-user",on:{click:function(a){return e.toMemberMag(t.row)}}})]}}])}),a("el-table-column",{attrs:{prop:"billCycle",label:e.$t("traffic.billCycle"),"show-overflow-tooltip":"","min-width":"110"}}),a("el-table-column",{attrs:{prop:"poolTotalValue",label:e.$t("traffic.usageAvaMonth"),"show-overflow-tooltip":"","min-width":"110"}}),a("el-table-column",{attrs:{prop:"poolUsageValue",label:e.$t("traffic.usageUsedMonth"),"show-overflow-tooltip":"","min-width":"110"}}),a("el-table-column",{attrs:{prop:"poolRemainValue",label:e.$t("traffic.usageRemainMonth"),"show-overflow-tooltip":"","min-width":"110"}}),a("el-table-column",{attrs:{prop:"effDate",label:e.$t("traffic.effDate"),"show-overflow-tooltip":"","min-width":"110"}}),a("el-table-column",{attrs:{prop:"expDate",label:e.$t("traffic.expDate"),"show-overflow-tooltip":"","min-width":"110"}})],1),a("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.tableData.length>0,expression:"tableData.length > 0"}],attrs:{background:"","current-page":e.page.pageIndex,align:"right","page-sizes":[10,20,50,100],"page-size":e.page.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.page.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},r=[],s=(t(70560),t(41090)),o=t(45101),i=t(71602),n=t.n(i),c={mixins:[s.Z],data(){return{loading:!1,page:{pageIndex:1,pageSize:10,total:0},tableData:[],qryParam:{billCycle:n()().format("YYYYMM"),accessNumber:"",addressIds:"121215042193"}}},computed:{paramRules(){return{addressIds:[{required:!0,trigger:"blur",message:this.selectPh("simMag.addressId")}]}}},mounted(){this.loadData(!1)},methods:{async loadData(e){await this.$refs.qryParamRef.validate(),e||(this.page.pageIndex=1,this.page.pageSize=10);const a={...this.qryParam,addressIds:[this.qryParam.addressIds],pageInfo:this.page};this.loading=!0;const t=await(0,o.Z)("/flowPool/qryForwardFlowPoolList",a,{method:"post"}).finally((()=>{this.loading=!1}));t.result?.forEach((e=>e.billCycle=this.qryParam.billCycle)),this.tableData=t.result||[],this.page.total=t.rowCount||0,this.qryAllFlowUsage()},async qryAllFlowUsage(){const e=this.tableData.map((e=>{const a={prodInstId:e.prodInstId,billMonth:this.qryParam.billCycle};return this.qrySimMonthFlowUsage(a)})),a=await Promise.all(e);a.forEach(((e,a)=>{this.$set(this.tableData[a],"poolRemainValue",e.poolRemainValue),this.$set(this.tableData[a],"poolTotalValue",e.poolTotalValue),this.$set(this.tableData[a],"poolUsageValue",e.poolUsageValue)}))},async qrySimMonthFlowUsage(e){const a=await(0,o.Z)("/usageData/queryForwardUsageInfo",e,{method:"get"});return a},async toDetail(e){const a={msisdn:e.accNum,pageInfo:{pageIndex:1,pageSize:10}},t=await(0,o.Z)("/prodInst/getSimCardPage",a,{method:"post"}),l=this.tableData.findIndex((a=>a.accNum==e.accNum));if(t.result&&t.result[l]){const e=t.result[l];this.$router.push({path:"/infoQuery/simDetail",query:{row:JSON.stringify(e)}})}},toMemberMag(e){this.$set(e,"billMonth",this.qryParam.billCycle),this.$router.push({path:"/infoQuery/frontMemberMag",query:{row:JSON.stringify(e)}})},handleSizeChange(e){this.page.pageSize=e,this.page.pageIndex=1,this.loadData(!0)},handleCurrentChange(e){this.page.pageIndex=e,this.loadData(!0)},reset(){this.$refs.qryParamRef.resetFields(),this.$nextTick((()=>this.loadData(!1)))}}},u=c,p=t(43736),d=(0,p.Z)(u,l,r,!1,null,"1a191631",null),m=d.exports}}]);
//# sourceMappingURL=68.c4b72d8c.js.map