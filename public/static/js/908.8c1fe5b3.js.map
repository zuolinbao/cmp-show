{"version":3,"file":"static/js/908.8c1fe5b3.js","mappings":"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","sources":["webpack://cmp/./src/views/rule/ruleMag/modfiy.vue","webpack://cmp/src/views/rule/ruleMag/modfiy.vue","webpack://cmp/./src/views/rule/ruleMag/modfiy.vue?a242","webpack://cmp/./src/views/rule/ruleMag/modfiy.vue?fe62"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"container-steps\"},[_c('CtSteps',{attrs:{\"total-steps\":_vm.stepsLabel.length,\"current-step\":_vm.currentStep,\"steps-label\":_vm.stepsLabel}})],1),(_vm.currentStep == 1)?_c('div',{staticClass:\"container-two-box\"},[_c('two-box',{ref:\"twoBoxRef\",attrs:{\"supplier-nbr\":_vm.supplierNbr,\"rule-sub-type\":_vm.ruleSubType,\"two-box-data\":_vm.twoBoxData,\"supplier\":_vm.supplier},on:{\"update:ruleSubType\":function($event){_vm.ruleSubType=$event},\"update:rule-sub-type\":function($event){_vm.ruleSubType=$event}}})],1):_vm._e(),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentStep != 0),expression:\"currentStep != 0\"}],staticClass:\"container-bottom\"},[_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"loading\":_vm.loading},on:{\"click\":_vm.submit}},[_vm._v(_vm._s(_vm.$t('rule.complete')))]),_c('el-button',{attrs:{\"size\":\"small\"},on:{\"click\":_vm.clearAdd}},[_vm._v(_vm._s(_vm.$t('rule.cancellation')))])],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"container\">\n    <div class=\"container-steps\">\n      <CtSteps\n        :total-steps=\"stepsLabel.length\"\n        :current-step=\"currentStep\"\n        :steps-label=\"stepsLabel\"\n      />\n    </div>\n    <div v-if=\"currentStep == 1\" class=\"container-two-box\">\n      <two-box\n        ref=\"twoBoxRef\"\n        :supplier-nbr=\"supplierNbr\"\n        :rule-sub-type.sync=\"ruleSubType\"\n        :two-box-data=\"twoBoxData\"\n        :supplier=\"supplier\"\n      ></two-box>\n    </div>\n    <div v-show=\"currentStep != 0\" class=\"container-bottom\">\n      <!-- <el-button size=\"small\" class=\"add-button\" @click=\"goBack\">上一步</el-button> -->\n      <el-button size=\"small\" type=\"primary\" :loading=\"loading\" @click=\"submit\">{{\n        $t('rule.complete')\n      }}</el-button>\n      <el-button size=\"small\" @click=\"clearAdd\">{{ $t('rule.cancellation') }}</el-button>\n    </div>\n  </div>\n</template>\n<script>\nimport fetch from '@/request/fetch'\nimport CtSteps from '@/components/CtSteps'\nimport twoBox from './components/twoBox.vue'\nimport { ruleTypeFromSubType, polyFillParams } from '../constant'\nexport default {\n  components: {\n    CtSteps,\n    twoBox,\n  },\n  data() {\n    return {\n      currentStep: 1,\n      supplierNbr: '',\n      ruleSubType: 0,\n      twoBoxData: {},\n      supplier: {},\n      loading: false,\n    }\n  },\n  computed: {\n    stepsLabel() {\n      return [\n        this.$t('rule.selectRule'),\n        this.$t('rule.setRule'),\n        this.$t('forgetPassword.finished'),\n      ]\n    },\n  },\n  mounted() {\n    if (Object.keys(this.$route.params).length > 0) {\n      const params = this.$route.params\n      const row = JSON.parse(params.row)\n      const supplier = JSON.parse(params.supplier)\n      this.supplierNbr = row.supplierNbr\n      this.extCustId = row.extCustId\n      this.ruleSubType = row.ruleSubType\n      row.ruleValue = row.ruleValue ? row.ruleValue.split(',') : ['']\n      this.twoBoxData = row\n      this.supplier = supplier\n    }\n  },\n  methods: {\n    clearAdd() {\n      this.$router.push({\n        path: '/rule/ruleMag',\n      })\n    },\n    async submit() {\n      await this.$refs.twoBoxRef.$refs.ruleForm.validate()\n      const ruleSubType = this.ruleSubType\n      const params = {\n        ...this.$refs.twoBoxRef.ruleForm,\n        ruleSubType,\n        ruleType: ruleTypeFromSubType(ruleSubType),\n        supplierNbr: this.supplierNbr,\n        extCustId: this.extCustId,\n        actionType: 1,\n        valueType: 1,\n      }\n      // 校验阈值\n      if (this.$refs.twoBoxRef.thresholdSize > 0) {\n        let message = ''\n        this.$refs.twoBoxRef.ruleForm.ruleValue.forEach((item) => {\n          if (!item) return (message = this.$t('rule.thresholdCannotEmpty'))\n        })\n        if (message) return this.$message.error(message)\n        params.ruleValue = this.$refs.twoBoxRef.ruleForm.ruleValue.join(',')\n      } else {\n        params.ruleValue = '0'\n      }\n      this.loading = true\n      // 修改入参名\n      polyFillParams(params)\n      const res = await this.$api.rule.saveOrUpdateRuleStrategy(params).finally(() => {\n        this.loading = false\n      })\n      // 上传证书\n      if (\n        this.$refs.twoBoxRef.fileList.length > 0 &&\n        this.$refs.twoBoxRef.fileName !== this.twoBoxData.fileName\n      ) {\n        await this.$refs.twoBoxRef.getSave(res.ruleId)\n      }\n      // 删除证书\n      if (\n        this.twoBoxData.fileName &&\n        this.$refs.twoBoxRef.fileList.length === 0 &&\n        this.$refs.twoBoxRef.fileName === ''\n      ) {\n        await this.$api.rule.deleteCert({ ruleId: this.twoBoxData.ruleId })\n      }\n      // 批量上传\n      let file = null\n      let templateId = 0\n      if (this.$refs.twoBoxRef.$refs.addUpload.fileList.length > 0) {\n        file = this.$refs.twoBoxRef.$refs.addUpload.fileList[0]\n        templateId = 2000\n      } else if (this.$refs.twoBoxRef.$refs.delUpload.fileList.length > 0) {\n        file = this.$refs.twoBoxRef.$refs.delUpload.fileList[0]\n        templateId = 2001\n      }\n      if (file) {\n        const param = {\n          ...res,\n          file,\n          templateId,\n          userId: res.createStaff,\n        }\n        this.loading = true\n        const uploadRes = await fetch('/ruleCommon/upload', param, {\n          method: 'upload',\n        }).finally(() => {\n          this.loading = false\n        })\n        if (uploadRes && uploadRes.length > 0) {\n          this.errAlert(uploadRes)\n        } else {\n          this.toRuleMag()\n        }\n      } else {\n        this.toRuleMag()\n      }\n    },\n    toRuleMag() {\n      this.$router.push({\n        path: '/rule/ruleMag',\n      })\n    },\n    goBack() {\n      this.currentStep = 0\n    },\n    oneStep(item) {\n      this.currentStep = 1\n      this.supplierNbr = item.supplierNbr\n      this.ruleSubType = item.attrValue\n    },\n    errAlert(errMsgList) {\n      // 第二种错误提示类型\n      const h = this.$createElement\n      const msg = h('div', { class: 'error-msg-box' }, [\n        ...(function () {\n          const arr = []\n          errMsgList.forEach((item) => {\n            arr.push(h('p', { class: 'cor-red' }, item))\n          })\n          return arr\n        })(),\n      ])\n      this.$msgbox({\n        title: this.$t('batchUpload.subtmitFail'),\n        type: 'warning',\n        center: true,\n        message: msg,\n        showCancelButton: false,\n        confirmButtonText: this.$t('batchUpload.know'),\n      }).finally(() => {\n        this.toRuleMag()\n      })\n    },\n  },\n}\n</script>\n<style lang=\"scss\" scoped>\n::v-deep .add-button {\n  color: #4880ff;\n  border-color: #4880ff;\n}\n.container {\n  background: #eff1f4;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  .container-steps {\n    padding: 20px 94px;\n  }\n  ::v-deep .step {\n    background: #eff1f4;\n  }\n  .container-one-box,\n  .container-two-box {\n    flex: 1;\n    padding: 20px;\n    padding-top: 0;\n    overflow: auto;\n  }\n  .container-bottom {\n    background: #fff;\n    height: 60px;\n    padding: 14px 20px;\n    text-align: right;\n  }\n}\n</style>\n","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./modfiy.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./modfiy.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./modfiy.vue?vue&type=template&id=d9b787e2&scoped=true\"\nimport script from \"./modfiy.vue?vue&type=script&lang=js\"\nexport * from \"./modfiy.vue?vue&type=script&lang=js\"\nimport style0 from \"./modfiy.vue?vue&type=style&index=0&id=d9b787e2&prod&lang=scss&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d9b787e2\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","stepsLabel","length","currentStep","ref","supplierNbr","ruleSubType","twoBoxData","supplier","on","$event","_e","directives","name","rawName","value","expression","loading","submit","_v","_s","$t","clearAdd","staticRenderFns","components","CtSteps","twoBox","data","computed","mounted","Object","keys","$route","params","row","JSON","parse","extCustId","ruleValue","split","methods","$router","push","path","$refs","twoBoxRef","ruleForm","validate","ruleType","ruleTypeFromSubType","actionType","valueType","thresholdSize","message","forEach","item","$message","error","join","polyFillParams","res","$api","rule","saveOrUpdateRuleStrategy","finally","fileList","fileName","getSave","ruleId","deleteCert","file","templateId","addUpload","delUpload","param","userId","createStaff","uploadRes","fetch","method","errAlert","toRuleMag","goBack","oneStep","attrValue","errMsgList","h","$createElement","msg","class","arr","$msgbox","title","type","center","showCancelButton","confirmButtonText","component"],"sourceRoot":""}