"use strict";(self["webpackChunkcmp"]=self["webpackChunkcmp"]||[]).push([[121],{45295:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"container-steps"},[t("CtSteps",{attrs:{"total-steps":e.stepsLabel.length,"current-step":e.currentStep,"steps-label":e.stepsLabel}})],1),1==e.currentStep?t("div",{staticClass:"container-two-box"},[t("two-box",{ref:"twoBoxRef",attrs:{"supplier-nbr":e.supplierNbr,"rule-sub-type":e.ruleSubType,"two-box-data":e.twoBoxData,supplier:e.supplier},on:{"update:ruleSubType":function(t){e.ruleSubType=t},"update:rule-sub-type":function(t){e.ruleSubType=t}}})],1):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:0!=e.currentStep,expression:"currentStep != 0"}],staticClass:"container-bottom"},[t("el-button",{attrs:{size:"small",type:"primary",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.$t("rule.complete")))]),t("el-button",{attrs:{size:"small"},on:{click:e.clearAdd}},[e._v(e._s(e.$t("rule.cancellation")))])],1)])},l=[],i=(s(70560),s(45101)),a=s(2681),o=s(23790),u=s(80289),p={components:{CtSteps:a.Z,twoBox:o.Z},data(){return{currentStep:1,supplierNbr:"",ruleSubType:0,twoBoxData:{},supplier:{},loading:!1}},computed:{stepsLabel(){return[this.$t("rule.selectRule"),this.$t("rule.setRule"),this.$t("forgetPassword.finished")]}},mounted(){if(Object.keys(this.$route.params).length>0){const e=this.$route.params,t=JSON.parse(e.row),s=JSON.parse(e.supplier);this.supplierNbr=t.supplierNbr,this.extCustId=t.extCustId,this.ruleSubType=t.ruleSubType,t.ruleValue=t.ruleValue?t.ruleValue.split(","):[""],this.twoBoxData=t,this.supplier=s}},methods:{clearAdd(){this.$router.push({path:"/rule/ruleMag"})},async submit(){await this.$refs.twoBoxRef.$refs.ruleForm.validate();const e=this.ruleSubType,t={...this.$refs.twoBoxRef.ruleForm,ruleSubType:e,ruleType:(0,u.ex)(e),supplierNbr:this.supplierNbr,extCustId:this.extCustId,actionType:1,valueType:1};if(this.$refs.twoBoxRef.thresholdSize>0){let e="";if(this.$refs.twoBoxRef.ruleForm.ruleValue.forEach((t=>{if(!t)return e=this.$t("rule.thresholdCannotEmpty")})),e)return this.$message.error(e);t.ruleValue=this.$refs.twoBoxRef.ruleForm.ruleValue.join(",")}else t.ruleValue="0";this.loading=!0,(0,u.o3)(t);const s=await this.$api.rule.saveOrUpdateRuleStrategy(t).finally((()=>{this.loading=!1}));this.$refs.twoBoxRef.fileList.length>0&&this.$refs.twoBoxRef.fileName!==this.twoBoxData.fileName&&await this.$refs.twoBoxRef.getSave(s.ruleId),this.twoBoxData.fileName&&0===this.$refs.twoBoxRef.fileList.length&&""===this.$refs.twoBoxRef.fileName&&await this.$api.rule.deleteCert({ruleId:this.twoBoxData.ruleId});let r=null,l=0;if(this.$refs.twoBoxRef.$refs.addUpload.fileList.length>0?(r=this.$refs.twoBoxRef.$refs.addUpload.fileList[0],l=2e3):this.$refs.twoBoxRef.$refs.delUpload.fileList.length>0&&(r=this.$refs.twoBoxRef.$refs.delUpload.fileList[0],l=2001),r){const e={...s,file:r,templateId:l,userId:s.createStaff};this.loading=!0;const t=await(0,i.Z)("/ruleCommon/upload",e,{method:"upload"}).finally((()=>{this.loading=!1}));t&&t.length>0?this.errAlert(t):this.toRuleMag()}else this.toRuleMag()},toRuleMag(){this.$router.push({path:"/rule/ruleMag"})},goBack(){this.currentStep=0},oneStep(e){this.currentStep=1,this.supplierNbr=e.supplierNbr,this.ruleSubType=e.attrValue},errAlert(e){const t=this.$createElement,s=t("div",{class:"error-msg-box"},[...function(){const s=[];return e.forEach((e=>{s.push(t("p",{class:"cor-red"},e))})),s}()]);this.$msgbox({title:this.$t("batchUpload.subtmitFail"),type:"warning",center:!0,message:s,showCancelButton:!1,confirmButtonText:this.$t("batchUpload.know")}).finally((()=>{this.toRuleMag()}))}}},n=p,h=s(43736),f=(0,h.Z)(n,r,l,!1,null,"d9b787e2",null),c=f.exports}}]);
//# sourceMappingURL=121.4bb1eb5c.js.map